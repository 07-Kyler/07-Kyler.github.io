<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>题解笔记</title>

  <!-- ========== KaTeX ========== -->
  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css"
        crossorigin="anonymous">

  <script defer
          src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"
          crossorigin="anonymous"></script>

  <script defer
          src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
          crossorigin="anonymous"
          onload="renderMathInElement(document.body,{
            delimiters:[
              {left:'$$',right:'$$',display:true},
              {left:'$',right:'$',display:false},
              {left:'\\\\(',right:'\\\\)',display:false},
              {left:'\\\\[',right:'\\\\]',display:true}
            ],
            throwOnError:false
          });"></script>

  <!-- ========== highlight.js（保持你可用的那一版） ========== -->
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/styles/github-dark.min.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/cpp.min.js"></script>

  <!-- ========== marked ========== -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <style>
    /* ======================
       原有布局 / 玻璃效果
       （这里假设你原来的 CSS 全在）
       ====================== */

    html, body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    /* ======== 关键修复点 ① ========
       不再用 * + !important 覆盖一切
       只控制正文，不影响 code / span
    */
    body:not(.dark-mode) article,
    body:not(.dark-mode) article *:not(code):not(span) {
      color: #111111;
    }

    body.dark-mode article,
    body.dark-mode article *:not(code):not(span) {
      color: #e0e0e0;
    }

    /* ======== 保留你原来的代码块玻璃背景 ======== */
    pre {
      padding: 18px 22px;
      border-radius: 16px;
      overflow-x: auto;
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      background: rgba(30, 30, 30, 0.35);
      border: 1px solid rgba(255,255,255,0.18);
    }

    pre code.hljs {
      background: transparent !important;
    }
  </style>
</head>

<body class="dark-mode">
  <div class="container">
    <!-- 左侧：题解导航（结构不动） -->
    <aside id="sidebar">
      <!-- 你原来的导航内容 -->
    </aside>

    <!-- 右侧：题解内容 -->
    <main>
      <article id="content"></article>
    </main>
  </div>

  <script>
    /* ======================
       marked + highlight.js
       ====================== */

    async function loadMarkdown(path) {
      const res = await fetch(path);
      const md = await res.text();

      const html = marked.parse(md, {
        breaks: true,
        gfm: true
      });

      const content = document.getElementById("content");
      content.innerHTML = html;

      /* ======== 关键修复点 ② ========
         确保在 marked 渲染完成后高亮
      */
      content.querySelectorAll("pre code").forEach(block => {
        if (!block.classList.contains("hljs")) {
          block.classList.add("hljs");
        }
        hljs.highlightElement(block);
      });
    }

    /* 示例：加载某篇题解 */
    loadMarkdown("solutions/example.md");
  </script>
</body>
</html>
